
scripts:
  sdk-select-jbang:
  - script: install-sdkman # requires util.yaml
  - sh:
      command: sdk install jbang ${{JBANG_VERSION:0.121.0}}
      prompt:
        "set as default? (Y/n): ": "Y"
  - sh:
      command: sdk use jbang ${{JBANG_VERSION:0.121.0}}

  install-hyperfoil-catalog:
  - script: sdk-select-jbang
    # it should be able to automatically fetch it by running the following cmd
  - sh: jbang catalog list hyperfoil

  upload-benchmark:
  - sh: if [ -d ${{HF_LOCAL_DIR}} ]; then rm -rf ${{HF_LOCAL_DIR}}; fi
  - sh: mkdir -p ${{HF_LOCAL_DIR}}
  - upload: ${{ENV.SCRIPT_DIR}}/${{HF_BENCHMARK_PATH}}/${{HF_BENCHMARK_FILE}} ${{HF_LOCAL_DIR}}/

  run-benchmark:
  - queue-download: ${{HF_REPORT_FILE}}
  - queue-download: ${{HF_BENCHMARK_REF}}
  - log: running Hyperfoil benchmark..
  - sh: jbang run@hyperfoil -o ${{HF_REPORT_FILE}} ${{HF_BENCHMARK_REF}} ${{HF_BENCHMARK_PARAMS:}}

  cleanup-hyperfoil:
  - sh: rm ${{HF_REPORT_FILE}} ${{HF_BENCHMARK_REF}}

states:
  JBANG_VERSION: "0.121.0"

  # path to the benchmark file relative to the root of this repo, e.g. ./benchmarks/get-all-villains
  HF_BENCHMARK_PATH:
  # name of the benchmark file, e.g. get-all-villains.hf.yaml
  HF_BENCHMARK_FILE:
  # path to the report generated file, e.g., /tmp/report.html
  HF_REPORT_FILE:
  HF_LOCAL_DIR: /tmp/hf-benchmarks
  HF_BENCHMARK_REF: ${{HF_LOCAL_DIR}}/${{HF_BENCHMARK_FILE}}

  # additional benchmark template params you want to provide, e.g., -PDURATION=20s -P.....
  HF_BENCHMARK_PARAMS:
